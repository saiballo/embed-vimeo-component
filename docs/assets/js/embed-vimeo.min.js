(()=>{var L=Object.defineProperty,S=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var f=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var b=(t,e,o)=>e in t?L(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,c=(t,e)=>{for(var o in e||(e={}))V.call(e,o)&&b(t,o,e[o]);if(f)for(var o of f(e))E.call(e,o)&&b(t,o,e[o]);return t},v=(t,e)=>S(t,T(e));var m=(t,e,o)=>new Promise((i,r)=>{var s=d=>{try{n(o.next(d))}catch(l){r(l)}},a=d=>{try{n(o.throw(d))}catch(l){r(l)}},n=d=>d.done?i(d.value):Promise.resolve(d.value).then(s,a);n((o=o.apply(t,e)).next())});var y={idEmbedContainer:"embed-container",idPosterContainer:"poster-container",idSpinnerContainer:"spinner-container",idPosterImg:"poster-img",idBtnPlay:"btn-play",activeIframeClass:"isactive",textVideoTitle:"Video da Vimeo",textVideoDescription:"Guarda questo video incorporato nel sito da Vimeo",textMissingVideoId:"ID video errato o mancante",textBtn:"Riproduci",textVideo:"video",spinnerColor:"#ff0000",videoStartAt:0,posterQuality:80,posterWidth:1024};var w=()=>{let t=new CSSStyleSheet;return t.replaceSync(` :host, :host *, :host *::before, :host *::after { box-sizing: border-box; } :host { contain: content; display: block; width: 100%; aspect-ratio: var(--aspect-ratio); --aspect-ratio: var(--embed-vimeo-aspect-ratio, 16 / 9); --aspect-ratio-short: var(--embed-vimeo-aspect-ratio-short, 9 / 16); } @media (max-width: 40em) { :host([short]) { aspect-ratio: var(--aspect-ratio-short); } } #embed-container { position: relative; width: 100%; height: 100%; aspect-ratio: 16 / 9; overflow: hidden; cursor: pointer; } #embed-container.isactive::before, #embed-container.isactive > #btn-play { display: none; } iframe, #poster-img { position: absolute; width: 100%; height: 100%; inset: 0; } iframe { border: 0; } #poster-img { object-fit: cover; box-sizing: border-box; } #btn-play { width: 68px; height: 38px; border: none; z-index: 1; background-color: transparent; background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 68 48' preserveAspectRatio='none'><rect width='68' height='48' rx='4' ry='4' fill='%23000'/><path d='M45 24 27 14v20' fill='%23fff'/></svg>"); background-repeat: no-repeat; background-position: center; background-size: 100% 100%; } #btn-play:before { content: ""; border-style: solid; border-width: 10px 0 10px 16px; border-color: transparent transparent transparent #fff; } #btn-play, #btn-play:before, #error-message { position: absolute; top: 50%; left: 50%; text-align: center; transform: translate3d(-50%, -50%, 0); cursor: inherit; } #error-message { width: 100%; } .isactive { cursor: unset; } #spinner-container { position: absolute; top: 50%; left: 50%; transform: translate3d(-50%, -50%, 0); } `),t};var I=t=>{let{config:e}=t;t.attachShadow({mode:"open"}),t.shadowRoot.adoptedStyleSheets=[w()],t.shadowRoot.innerHTML=`<div id="${e.idEmbedContainer}"><div id="${e.idSpinnerContainer}" part="spinner"><svg width="60" height="60" viewBox="0 0 44 44"><circle cx="50%" cy="50%" r="20" fill="none" stroke="#E5E7EB" stroke-width="4"></circle><circle cx="50%" cy="50%" r="20" fill="none" stroke="${e.spinnerColor}" stroke-width="4" stroke-dasharray="125.6" stroke-dashoffset="125.6"><animate attributeName="stroke-dashoffset" values="125.6;0" dur="1.5s" repeatCount="indefinite"></animate></circle></svg></div><picture id="${e.idPosterContainer}"><img id="${e.idPosterImg}" part="poster" referrerpolicy="origin" loading="lazy" alt=""></picture><button id="${e.idBtnPlay}" part="play-button" hidden></button></div>`,t.domContainer=t.shadowRoot.getElementById(e.idEmbedContainer),t.domPosterContainer=t.shadowRoot.getElementById(e.idPosterContainer),t.domImgPoster=t.shadowRoot.getElementById(e.idPosterImg),t.domPlayButton=t.shadowRoot.getElementById(e.idBtnPlay)};var g=(()=>{let t=!1,e=(o,i)=>{let r=document.createElement("link");r.rel=o,r.href=i,r.crossOrigin="true",document.head.append(r)};return o=>{t||o.noPreconnect||(e("preconnect","https://player.vimeo.com"),e("preconnect","https://i.vimeocdn.com"),e("preconnect","https://f.vimeocdn.com"),t=!0)}})(),P=t=>{if(!t)return"";let e=decodeURIComponent(t);if(/^(?:https?:\/\/|www\.)/.test(t)){if(e.includes("player.vimeo"))try{return new URL(e).pathname.split("/").pop()||""}catch(i){return""}return""}return e},C=t=>{if(!t.videoId||t.videoId===""){h(t.shadowRoot.getElementById(t.config.idSpinnerContainer),!0);let e=document.createElement("h2");return e.id="error-message",e.textContent=t.config.textMissingVideoId,t.domContainer.appendChild(e),console.log(t.config.textMissingVideoId),!0}return!1},A=t=>{let{config:e}=t,{videoId:o}=t,i=t.videoTitle||e.textVideoTitle,r=t.description||e.textVideoDescription,s=document.createElement("script");s.id=`json-${o}`,s.type="application/ld+json",s.text=JSON.stringify({"@context":"https://schema.org","@type":"VideoObject",name:`${i}`,description:`${r}`,contentUrl:`https://vimeo.com/${o}`,embedUrl:`https://player.vimeo.com/video/${o}`}),t.prepend(s)},k=t=>{let{config:e}=t;return t.playText&&t.videoTitle?`${t.playText} ${t.videoTitle}`:t.playText?t.playText:t.videoTitle?`${e.textBtn} ${t.videoTitle}`:`${e.textBtn} ${e.textVideo}`},h=(t,e=!0,o=250)=>{e?t.hidden=!0:setTimeout(()=>{t.hidden=!1},o)},$=(t,e)=>{let[o]=t.split("?"),i=o.replace(/d_\d+$/,`d_${e}`);return i.endsWith(".jpg")?i.substring(0,i.lastIndexOf(".")):i},x=(o,...i)=>m(null,[o,...i],function*(t,e={}){let{timeout:r=1e3}=e,s=new AbortController,a=setTimeout(()=>{s.abort()},r),n=yield fetch(t,v(c({},e),{signal:s.signal}));return clearTimeout(a),n});(()=>{"use strict";let t=document.currentScript||document.getElementsByTagName("body")[0];class e extends HTMLElement{constructor(){super(),this.config=c(c({},y),window.embedVimeoConfig||{}),this.scheduleUpdate,this.isIframeLoaded=!1,this.globalParam=t,I(this)}static get observedAttributes(){return["video-id","video-title","play-text","poster-url","poster-fallback","mute"]}connectedCallback(){C(this)||(this.setupComponent(),this.addEventListener("click",()=>{this.loadIframe()}),this.addEventListener("pointerover",()=>{g(this)},{once:!0}))}get videoId(){let i=this.getAttribute("video-id")||"",r=P(i);return encodeURIComponent(r)}get videoTitle(){return this.getAttribute("video-title")||this.config.textVideoTitle}get description(){return this.getAttribute("description")}get playText(){return this.getAttribute("play-text")}get videoStartAt(){return this.getAttribute("video-start-at")||this.config.videoStartAt}get autoLoadMargin(){return this.getAttribute("autoload-margin")||"0px"}get posterUrl(){return this.getAttribute("poster-url")}get posterQuality(){return this.getAttribute("poster-quality")||this.config.posterQuality}get posterWidth(){return this.getAttribute("poster-width")||this.config.posterWidth}get paramList(){return this.getAttribute("param-list")}get autoLoad(){return this.hasAttribute("autoload")||this.globalParam.hasAttribute("data-autoload")}get autoPlay(){return this.hasAttribute("autoplay")||this.globalParam.hasAttribute("data-autoplay")}get mute(){return this.hasAttribute("mute")||this.globalParam.hasAttribute("data-mute")}get autoPause(){return this.hasAttribute("autopause")||this.globalParam.hasAttribute("data-autopause")}get noTracking(){return this.hasAttribute("no-tracking")||this.globalParam.hasAttribute("data-no-tracking")}get noSchema(){return this.hasAttribute("no-schema")||this.globalParam.hasAttribute("data-no-schema")}get noPreconnect(){return this.hasAttribute("no-preconnect")||this.globalParam.hasAttribute("data-no-preconnect")}get noLazyLoad(){return this.hasAttribute("no-lazyload")}get posterFallback(){return this.hasAttribute("poster-fallback")}setupComponent(){let i=k(this);this.domPlayButton.setAttribute("aria-label",i),this.setAttribute("title",i),this.domImgPoster.src="",this.noLazyLoad&&this.domImgPoster.removeAttribute("loading"),this.posterFallback?this.setPosterFallback():this.posterUrl?this.setPosterCustom():this.setPoster(),this.autoLoad&&this.autoLoadIframe(),this.autoPause&&this.autoPauseVideo(),this.noSchema||A(this)}createIframe(){let i;if(this.paramList&&this.paramList!=="")i=this.paramList;else{let s=this.noTracking?1:0,a=this.autoPlay&&this.autoLoad||!this.autoPlay&&!this.autoLoad?1:0,n=this.mute?1:0,d=this.videoStartAt;i=`dnt=${s}&transparent=1&title=0&${i}&autoplay=${a}`,a&&this.autoPlay?i=`${i}&muted=1`:i=`${i}&muted=${n}`,i=`${i}#t=${d}`}return`<iframe title="vimeo-player" src="https://player.vimeo.com/video/${this.videoId}?${i}" frameborder="0" allowfullscreen allow="autoplay; fullscreen; picture-in-picture"></iframe>`}loadIframe(){if(!this.isIframeLoaded){let i=this.createIframe();this.domContainer.insertAdjacentHTML("beforeend",i),this.domContainer.classList.add(this.config.activeIframeClass),this.isIframeLoaded=!0,this.dispatchEvent(new CustomEvent("embedVimeoLoaded",{detail:{videoId:this.videoId,videoTitle:this.videoTitle,posterUrl:this.posterUrl},bubbles:!0,cancelable:!0}))}}autoLoadIframe(){let i={root:null,rootMargin:this.autoLoadMargin,threshold:0};new IntersectionObserver((s,a)=>{s.forEach(n=>{n.isIntersecting&&!this.isIframeLoaded&&(g(this),this.loadIframe(!0),a.unobserve(this))})},i).observe(this)}autoPauseVideo(){new IntersectionObserver(r=>{r.forEach(s=>{var a,n;s.isIntersecting||(n=(a=this.shadowRoot.querySelector("iframe"))==null?void 0:a.contentWindow)==null||n.postMessage('{"method": "pause"}',"*")})},{threshold:0}).observe(this)}setPosterFallback(){var s,a;let i=`<svg part="poster-fallback" xmlns="http://www.w3.org/2000/svg" viewBox="0 48 294 198" width="294" height="198"><path d="M294,48 c0-8.284-6.716-15-15-15H15 C6.716,33,0,39.716,0,48v198 c0,8.284,6.716,15,15,15h264 c8.284,0,15-6.716,15-15V48z" fill="black"/><path transform="translate(0,6)" d="M124,113 L124,155 L161,134 Z" fill="white"/><g transform="translate(0,-35)"><rect x="30.333" y="232" width="233" height="1" fill="white"/><rect x="74" y="228" width="15" height="10" fill="white"/></g><text x="147" y="95" fill="white" font-family="Verdana, sans-serif" font-size="18" font-weight="bold" text-anchor="middle">Play video</text></svg>`;this.getAttribute("poster-fallback")||this.setAttribute("poster-fallback",""),h(this.domPlayButton,!0),this.domPlayButton.setAttribute("aria-hidden","true"),(s=this.domPosterContainer.querySelector("#img-webp"))==null||s.remove(),(a=this.domPosterContainer.querySelector("#img-jpg"))==null||a.remove();let r=`data:image/svg+xml;charset=UTF-8,${encodeURIComponent(i)}`;this.domImgPoster.src=r,this.domImgPoster.removeAttribute("loading"),this.domImgPoster.setAttribute("alt","")}setPosterCustom(){this.domImgPoster.src=this.posterUrl,this.domImgPoster.onload=()=>{this.posterFallback||(this.domImgPoster.setAttribute("alt",this.videoTitle),h(this.domPlayButton,!1))},this.domImgPoster.onerror=()=>{this.posterUrl&&this.setPosterFallback()}}setPoster(){return m(this,null,function*(){try{let i=`https://vimeo.com/api/v2/video/${this.videoId}.json`,r=yield x(i);if(!r.ok){this.setPosterFallback();return}let[s]=yield r.json(),a=$(s.thumbnail_large,this.posterWidth),n=`${a}.webp?mw=1280&mh=720&q=${this.posterQuality}`,d=`${a}.jpg?mw=1280&mh=720&q=${this.posterQuality}`,l=new Image;l.src=n,l.onload=()=>{let u=document.createElement("source");u.id="img-webp",u.setAttribute("type","image/webp");let p=document.createElement("source");p.id="img-jpg",p.setAttribute("type","image/jpeg"),this.domPosterContainer.prepend(u,p),this.domPosterContainer.querySelector("#img-webp").srcset=n,this.domPosterContainer.querySelector("#img-jpg").srcset=d,this.domImgPoster.src=d,h(this.domPlayButton,!1)}}catch(i){console.log("Errore caricamento immagine Vimeo",i),this.setPosterFallback()}})}attributeChangedCallback(i,r,s){if(r===null||r===s)return;this.scheduleUpdate&&cancelAnimationFrame(this.scheduleUpdate);let a=i==="video-id"?r:this.videoId;!this.noSchema&&this.querySelector(`#json-${a}`)&&this.querySelector(`#json-${a}`).remove(),this.scheduleUpdate=requestAnimationFrame(()=>{this.domContainer.classList.contains(this.config.activeIframeClass)&&(this.domContainer.classList.remove(this.config.activeIframeClass),this.shadowRoot.querySelector("iframe").remove(),this.isIframeLoaded=!1),this.setupComponent()})}}customElements.define("embed-vimeo",e)})();})();
