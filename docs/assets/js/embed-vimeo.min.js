(()=>{var x=Object.defineProperty,L=Object.defineProperties;var S=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var f=(e,t,i)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,c=(e,t)=>{for(var i in t||(t={}))T.call(t,i)&&f(e,i,t[i]);if(g)for(var i of g(t))E.call(t,i)&&f(e,i,t[i]);return e},b=(e,t)=>L(e,S(t));var m=(e,t,i)=>new Promise((r,o)=>{var s=a=>{try{d(i.next(a))}catch(l){o(l)}},n=a=>{try{d(i.throw(a))}catch(l){o(l)}},d=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,n);d((i=i.apply(e,t)).next())});var v={idEmbedContainer:"embed-container",idPosterContainer:"poster-container",idSpinnerContainer:"spinner-container",idPosterImg:"poster-img",idBtnPlay:"btn-play",activeIframeClass:"isactive",textVideoTitle:"Video da Vimeo",textVideoDescription:"Guarda questo video incorporato nel sito da Vimeo",textMissingVideoId:"ID video errato o mancante",textBtn:"Riproduci",textVideo:"video",spinnerColor:"#ff0000",videoStartAt:0,posterQuality:80,posterWidth:1024};var y=()=>{let e=new CSSStyleSheet;return e.replaceSync(` :host, :host *, :host *::before, :host *::after { box-sizing: border-box; } :host { contain: content; display: block; width: 100%; aspect-ratio: var(--aspect-ratio); --aspect-ratio: var(--embed-vimeo-aspect-ratio, 16 / 9); --aspect-ratio-short: var(--embed-vimeo-aspect-ratio-short, 9 / 16); } @media (max-width: 40em) { :host([short]) { aspect-ratio: var(--aspect-ratio-short); } } #embed-container { position: relative; width: 100%; height: 100%; aspect-ratio: 16 / 9; overflow: hidden; cursor: pointer; } #embed-container.isactive::before, #embed-container.isactive > #btn-play { display: none; } iframe, #poster-img { position: absolute; width: 100%; height: 100%; inset: 0; } iframe { border: 0; } #poster-img { object-fit: cover; box-sizing: border-box; } #btn-play { width: 68px; height: 38px; border: none; z-index: 1; background-color: transparent; background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 68 48' preserveAspectRatio='none'><rect width='68' height='48' rx='4' ry='4' fill='%23000'/><path d='M45 24 27 14v20' fill='%23fff'/></svg>"); background-repeat: no-repeat; background-position: center; background-size: 100% 100%; } #btn-play:before { content: ""; border-style: solid; border-width: 10px 0 10px 16px; border-color: transparent transparent transparent #fff; } #btn-play, #btn-play:before, #error-message { position: absolute; top: 50%; left: 50%; text-align: center; transform: translate3d(-50%, -50%, 0); cursor: inherit; } #error-message { width: 100%; } .isactive { cursor: unset; } #spinner-container { position: absolute; top: 50%; left: 50%; transform: translate3d(-50%, -50%, 0); } `),e};var w=e=>{let{config:t}=e;e.attachShadow({mode:"open"}),e.shadowRoot.adoptedStyleSheets=[y()],e.shadowRoot.innerHTML=`<div id="${t.idEmbedContainer}"><div id="${t.idSpinnerContainer}" part="spinner"><svg width="60" height="60" viewBox="0 0 44 44"><circle cx="50%" cy="50%" r="20" fill="none" stroke="#E5E7EB" stroke-width="4"></circle><circle cx="50%" cy="50%" r="20" fill="none" stroke="${t.spinnerColor}" stroke-width="4" stroke-dasharray="125.6" stroke-dashoffset="125.6"><animate attributeName="stroke-dashoffset" values="125.6;0" dur="1.5s" repeatCount="indefinite"></animate></circle></svg></div><picture id="${t.idPosterContainer}"><img id="${t.idPosterImg}" part="poster" referrerpolicy="origin" loading="lazy" alt=""></picture><button id="${t.idBtnPlay}" part="play-button" hidden></button></div>`,e.domContainer=e.shadowRoot.getElementById(t.idEmbedContainer),e.domPosterContainer=e.shadowRoot.getElementById(t.idPosterContainer),e.domImgPoster=e.shadowRoot.getElementById(t.idPosterImg),e.domPlayButton=e.shadowRoot.getElementById(t.idBtnPlay)};var u=(()=>{let e=!1,t=(i,r)=>{let o=document.createElement("link");o.rel=i,o.href=r,o.crossOrigin="true",document.head.append(o)};return i=>{e||i.noPreconnect||(t("preconnect","https://player.vimeo.com"),t("preconnect","https://i.vimeocdn.com"),t("preconnect","https://f.vimeocdn.com"),e=!0)}})(),I=e=>{if(!e)return"";let t=decodeURIComponent(e);if(/^(?:https?:\/\/|www\.)/.test(e)){if(t.includes("player.vimeo"))try{return new URL(t).pathname.split("/").pop()||""}catch(r){return""}return""}return t},P=e=>{if(!e.videoId||e.videoId===""){h(e.shadowRoot.getElementById(e.config.idSpinnerContainer),!0);let t=document.createElement("h2");return t.id="error-message",t.textContent=e.config.textMissingVideoId,e.domContainer.appendChild(t),!0}return!1},C=e=>{let{config:t}=e,{videoId:i}=e,r=e.videoTitle||t.textVideoTitle,o=e.description||t.textVideoDescription,s=document.createElement("script");s.id=`json-${i}`,s.type="application/ld+json",s.text=JSON.stringify({"@context":"https://schema.org","@type":"VideoObject",name:`${r}`,description:`${o}`,contentUrl:`https://vimeo.com/${i}`,embedUrl:`https://player.vimeo.com/video/${i}`}),e.prepend(s)},A=e=>{let{config:t}=e;return e.playText&&e.videoTitle?`${e.playText} ${e.videoTitle}`:e.playText?e.playText:e.videoTitle?`${t.textBtn} ${e.videoTitle}`:`${t.textBtn} ${t.textVideo}`},h=(e,t=!0,i=250)=>{t?e.hidden=!0:setTimeout(()=>{e.hidden=!1},i)},k=(e,t)=>{let[i]=e.split("?"),r=i.replace(/d_\d+$/,`d_${t}`);return r.endsWith(".jpg")?r.substring(0,r.lastIndexOf(".")):r},$=(i,...r)=>m(null,[i,...r],function*(e,t={}){let{timeout:o=1e3}=t,s=new AbortController,n=setTimeout(()=>{s.abort()},o),d=yield fetch(e,b(c({},t),{signal:s.signal}));return clearTimeout(n),d});var p=class extends HTMLElement{constructor(){super(),this.config=c(c({},v),window.embedVimeoConfig||{}),this.scheduleUpdate=null,this.isIframeLoaded=!1,this.globalParam=document.currentScript||document.getElementsByTagName("body")[0],w(this)}get videoId(){let t=this.getAttribute("video-id")||"",i=I(t);return encodeURIComponent(i)}get videoTitle(){return this.getAttribute("video-title")||this.config.textVideoTitle}get description(){return this.getAttribute("description")}get playText(){return this.getAttribute("play-text")}get videoStartAt(){return this.getAttribute("video-start-at")||this.config.videoStartAt}get autoLoadMargin(){return this.getAttribute("autoload-margin")||"0px"}get posterUrl(){return this.getAttribute("poster-url")}get posterQuality(){return this.getAttribute("poster-quality")||this.config.posterQuality}get posterWidth(){return this.getAttribute("poster-width")||this.config.posterWidth}get paramList(){return this.getAttribute("param-list")}get autoLoad(){return this.hasAttribute("autoload")||this.globalParam.hasAttribute("data-autoload")}get autoPlay(){return this.hasAttribute("autoplay")||this.globalParam.hasAttribute("data-autoplay")}get mute(){return this.hasAttribute("mute")||this.globalParam.hasAttribute("data-mute")}get autoPause(){return this.hasAttribute("autopause")||this.globalParam.hasAttribute("data-autopause")}get noTracking(){return this.hasAttribute("no-tracking")||this.globalParam.hasAttribute("data-no-tracking")}get noSchema(){return this.hasAttribute("no-schema")||this.globalParam.hasAttribute("data-no-schema")}get noPreconnect(){return this.hasAttribute("no-preconnect")||this.globalParam.hasAttribute("data-no-preconnect")}get noLazyLoad(){return this.hasAttribute("no-lazyload")}get posterFallback(){return this.hasAttribute("poster-fallback")}static get observedAttributes(){return["video-id","video-title","play-text","poster-url","poster-fallback","mute"]}connectedCallback(){P(this)||(this.setupComponent(),this.addEventListener("click",()=>{this.loadIframe()}),this.addEventListener("pointerover",()=>{u(this)},{once:!0}))}setupComponent(){let t=A(this);this.domPlayButton.setAttribute("aria-label",t),this.setAttribute("title",t),this.domImgPoster.src="",this.noLazyLoad&&this.domImgPoster.removeAttribute("loading"),this.posterFallback?this.setPosterFallback():this.posterUrl?this.setPosterCustom():this.setPoster(),this.autoLoad&&this.autoLoadIframe(),this.autoPause&&this.autoPauseVideo(),this.noSchema||C(this)}createIframe(){let t;if(this.paramList&&this.paramList!=="")t=this.paramList;else{let r=this.noTracking?1:0,o=this.autoPlay&&this.autoLoad||!this.autoPlay&&!this.autoLoad?1:0,s=this.mute?1:0,n=this.videoStartAt;t=`dnt=${r}&transparent=1&title=0&${t}&autoplay=${o}`,o&&this.autoPlay?t=`${t}&muted=1`:t=`${t}&muted=${s}`,t=`${t}#t=${n}`}return`<iframe title="vimeo-player" src="https://player.vimeo.com/video/${this.videoId}?${t}" frameborder="0" allowfullscreen allow="autoplay; fullscreen; picture-in-picture"></iframe>`}loadIframe(){if(!this.isIframeLoaded){let t=this.createIframe();this.domContainer.insertAdjacentHTML("beforeend",t),this.domContainer.classList.add(this.config.activeIframeClass),this.isIframeLoaded=!0,this.dispatchEvent(new CustomEvent("embedVimeoLoaded",{detail:{videoId:this.videoId,videoTitle:this.videoTitle,posterUrl:this.posterUrl},bubbles:!0,cancelable:!0}))}}autoLoadIframe(){let t={root:null,rootMargin:this.autoLoadMargin,threshold:0};this.observerIframe=new IntersectionObserver((i,r)=>{i.forEach(o=>{o.isIntersecting&&!this.isIframeLoaded&&(u(this),this.loadIframe(!0),r.unobserve(this))})},t),this.observerIframe.observe(this)}autoPauseVideo(){this.observerVideo=new IntersectionObserver(t=>{t.forEach(i=>{var r,o;i.isIntersecting||(o=(r=this.shadowRoot.querySelector("iframe"))==null?void 0:r.contentWindow)==null||o.postMessage('{"method": "pause"}',"*")})},{threshold:0}),this.observerVideo.observe(this)}setPosterFallback(){var r,o;let t=`<svg part="poster-fallback" xmlns="http://www.w3.org/2000/svg" viewBox="0 48 294 198" width="294" height="198"><path d="M294,48 c0-8.284-6.716-15-15-15H15 C6.716,33,0,39.716,0,48v198 c0,8.284,6.716,15,15,15h264 c8.284,0,15-6.716,15-15V48z" fill="black"/><path transform="translate(0,6)" d="M124,113 L124,155 L161,134 Z" fill="white"/><g transform="translate(0,-35)"><rect x="30.333" y="232" width="233" height="1" fill="white"/><rect x="74" y="228" width="15" height="10" fill="white"/></g><text x="147" y="95" fill="white" font-family="Verdana, sans-serif" font-size="18" font-weight="bold" text-anchor="middle">Play video</text></svg>`;this.getAttribute("poster-fallback")||this.setAttribute("poster-fallback",""),h(this.domPlayButton,!0),this.domPlayButton.setAttribute("aria-hidden","true"),(r=this.domPosterContainer.querySelector("#img-webp"))==null||r.remove(),(o=this.domPosterContainer.querySelector("#img-jpg"))==null||o.remove();let i=`data:image/svg+xml;charset=UTF-8,${encodeURIComponent(t)}`;this.domImgPoster.src=i,this.domImgPoster.removeAttribute("loading"),this.domImgPoster.setAttribute("alt","")}setPosterCustom(){this.domImgPoster.src=this.posterUrl,this.domImgPoster.onload=()=>{this.posterFallback||(this.domImgPoster.setAttribute("alt",this.videoTitle),h(this.domPlayButton,!1))},this.domImgPoster.onerror=()=>{this.posterUrl&&this.setPosterFallback()}}setPoster(){return m(this,null,function*(){try{let t=`https://vimeo.com/api/v2/video/${this.videoId}.json`,i=yield $(t);if(!i.ok){this.setPosterFallback();return}let[r]=yield i.json(),o=k(r.thumbnail_large,this.posterWidth),s=`${o}.webp?mw=1280&mh=720&q=${this.posterQuality}`,n=`${o}.jpg?mw=1280&mh=720&q=${this.posterQuality}`,d=new Image;d.src=s,d.onload=()=>{let a=document.createElement("source");a.id="img-webp",a.setAttribute("type","image/webp");let l=document.createElement("source");l.id="img-jpg",l.setAttribute("type","image/jpeg"),this.domPosterContainer.prepend(a,l),this.domPosterContainer.querySelector("#img-webp").srcset=s,this.domPosterContainer.querySelector("#img-jpg").srcset=n,this.domImgPoster.src=n,h(this.domPlayButton,!1)}}catch(t){console.log("Errore caricamento immagine Vimeo",t),this.setPosterFallback()}})}attributeChangedCallback(t,i,r){if(i===null||i===r)return;this.scheduleUpdate&&cancelAnimationFrame(this.scheduleUpdate);let o=t==="video-id"?i:this.videoId;!this.noSchema&&this.querySelector(`#json-${o}`)&&this.querySelector(`#json-${o}`).remove(),this.scheduleUpdate=requestAnimationFrame(()=>{this.domContainer.classList.contains(this.config.activeIframeClass)&&(this.domContainer.classList.remove(this.config.activeIframeClass),this.shadowRoot.querySelector("iframe").remove(),this.isIframeLoaded=!1),this.setupComponent()})}disconnectedCallback(){var t,i;(t=this.observerIframe)==null||t.disconnect(),(i=this.observerVideo)==null||i.disconnect()}};customElements.get("embed-vimeo")||customElements.define("embed-vimeo",p);})();
